<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Auto Share — MBU Transport</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Leaflet for map placeholder (tiles may require network) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9aa4b2;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071026 0%, #081827 60%);color:#e6eef6;min-height:100vh}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);backdrop-filter:blur(6px)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022;}
    .title{font-weight:600}
    main{display:grid;grid-template-columns:360px 1fr 380px;gap:18px;padding:22px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow: 0 6px 18px rgba(2,6,23,0.6);}
    .search{display:flex;gap:8px}
    input,select,button{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button.primary{background:linear-gradient(90deg,var(--accent),#3b82f6);color:#022;border:none;font-weight:600}
    h3{margin:6px 0 12px 0}
    .list{display:flex;flex-direction:column;gap:8px}
    .list .row{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:var(--glass);align-items:center}
    #map{height:320px;border-radius:10px;background:#071022}
    .analytics{display:grid;grid-template-rows:1fr 1fr;gap:12px}
    footer{padding:16px;text-align:center;color:var(--muted);font-size:13px}
    .muted{color:var(--muted);font-size:13px}
    .badge{padding:6px 8px;background:rgba(255,255,255,0.03);border-radius:999px;font-weight:600}
    .small{font-size:13px}
    @media(max-width:980px){main{grid-template-columns:1fr;padding:12px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">MBU</div>
      <div>
        <div class="title">Smart Auto Share</div>
        <div class="muted small">Balancing demand & supply for MBU students</div>
      </div>
    </div>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="badge">Realtime</div>
      <button class="primary" onclick="simulateNotification()">Notify Drivers</button>
    </div>
  </header>

  <main>
    <!-- Left column: Booking + Recent Requests -->
    <section class="card">
      <h3>Quick Booking</h3>
      <div class="small muted">Book a seat, create a shared ride, or request an urgent auto.</div>
      <form id="bookingForm" onsubmit="event.preventDefault();createBooking()" style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
        <input id="from" placeholder="From (e.g., MBU Campus)" value="MBU Campus" required />
        <input id="to" placeholder="To (e.g., Tirupati Bus Stand)" value="Tirupati" required />
        <div style="display:flex;gap:8px">
          <select id="rideType">
            <option value="share">Share (cheapest)</option>
            <option value="private">Private</option>
            <option value="pool">Pool (route-match)</option>
          </select>
          <input id="seats" type="number" min="1" max="4" value="1" style="width:86px" />
        </div>
        <div style="display:flex;gap:8px">
          <button class="primary" type="submit">Create Booking</button>
          <button type="button" onclick="estimateFare()">Estimate Fare</button>
        </div>
      </form>

      <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)">
      <h3>Recent Requests</h3>
      <div id="requests" class="list">
        <!-- rows injected by JS -->
      </div>
    </section>

    <!-- Middle column: Map + Predictions -->
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Live Map & Demand Predictions</h3>
        <div class="muted small">Last update: <span id="lastUpdate">—</span></div>
      </div>

      <div id="map"></div>

      <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
        <div style="flex:1">
          <canvas id="demandChart" height="120"></canvas>
        </div>
        <div style="width:180px">
          <div class="small muted">Predicted hotspots</div>
          <ul class="small" id="hotspots">
            <!-- populated by JS -->
          </ul>
        </div>
      </div>
    </section>

    <!-- Right column: Drivers, Analytics, Pricing -->
    <aside class="card">
      <h3>Drivers Online</h3>
      <div id="drivers" class="list" style="margin-bottom:12px"></div>

      <h3>Analytics</h3>
      <div class="analytics">
        <div>
          <canvas id="visitsChart" height="140"></canvas>
        </div>
        <div>
          <h4 class="small">Top Destinations</h4>
          <div id="topPlaces" class="list small"></div>
        </div>
      </div>

      <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)">
      <h3>Fare Transparency</h3>
      <div class="small muted">Base fare + distance + dynamic supply multiplier</div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <input id="distanceKm" type="number" placeholder="km" style="width:86px" />
        <button onclick="calcFareFromUI()">Calc</button>
      </div>
      <div id="fareResult" style="margin-top:8px;font-weight:600"></div>
    </aside>
  </main>

  <footer>
    Prototype UI — simulates booking, driver availability, demand prediction (client-only). Share if you want a React or backend version.
  </footer>

  <script>
    // Simple in-memory lists (mock)
    const requestsEl = document.getElementById('requests');
    const driversEl = document.getElementById('drivers');
    const hotspotsEl = document.getElementById('hotspots');
    const topPlacesEl = document.getElementById('topPlaces');
    const lastUpdateEl = document.getElementById('lastUpdate');

    let bookings = [];
    let drivers = [];

    // map init
    const map = L.map('map', {zoomControl:true}).setView([13.6288,79.4192], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(map);

    // add campus marker
    const campusMarker = L.marker([13.6288,79.4192]).addTo(map).bindPopup('MBU Campus');

    function refreshRequests(){
      requestsEl.innerHTML='';
      bookings.slice().reverse().forEach(b=>{
        const div=document.createElement('div');div.className='row';
        div.innerHTML=`<div><strong>${b.to}</strong><div class=muted small>${b.type} • ${b.seats} seat(s)</div></div><div><button onclick="matchRide('${b.id}')">Match</button></div>`;
        requestsEl.appendChild(div);
      });
    }

    function refreshDrivers(){
      driversEl.innerHTML='';
      drivers.forEach(d=>{
        const div=document.createElement('div');div.className='row';
        div.innerHTML=`<div><strong>${d.name}</strong><div class=muted small>${d.status} • ${d.car}</div></div><div class=muted>${d.dist} km</div>`;
        driversEl.appendChild(div);
      });
    }

    // mock create booking
    function createBooking(){
      const to=document.getElementById('to').value;
      const type=document.getElementById('rideType').value;
      const seats=document.getElementById('seats').value;
      const id='r'+Date.now();
      bookings.push({id,to,type,seats,created:Date.now()});
      refreshRequests();
      toast('Booking created — waiting for match');
      runPrediction();
    }

    // fare estimate
    function estimateFare(){
      const km = Math.max(1, Math.round((Math.random()*22)+2));
      const fare = calcFare(km);
      alert(`Estimated fare for ${km} km: ₹${fare}`);
    }

    function calcFare(km){
      const base = 30; // base fare
      const perKm = 6; // per km
      // simple dynamic multiplier based on mock driver supply
      const supply = Math.max(1, drivers.length);
      const demand = Math.max(1, bookings.length);
      const multiplier = Math.max(1, (demand / supply) * 0.6 + 1);
      return Math.round((base + perKm*km) * multiplier);
    }
    function calcFareFromUI(){
      const km = Number(document.getElementById('distanceKm').value) || 0;
      if(km<=0){toast('Enter distance in km');return}
      document.getElementById('fareResult').textContent = '₹' + calcFare(km);
    }

    // mock driver data
    function seedDrivers(){
      drivers = [
        {name:'Ravi',car:'AutoA-123',status:'available',dist:1.2},
        {name:'Sita',car:'AutoB-987',status:'on trip',dist:3.4},
        {name:'Kumar',car:'AutoC-555',status:'available',dist:0.6},
      ];
      refreshDrivers();
    }

    // match ride (very simple)
    function matchRide(id){
      const req = bookings.find(b=>b.id===id);
      if(!req){toast('Request not found');return}
      // pick nearest available driver
      const avail = drivers.filter(d=>d.status==='available');
      if(avail.length===0){toast('No available drivers — notifying network');simulateNotification();return}
      const driver = avail[Math.floor(Math.random()*avail.length)];
      driver.status='assigned';
      refreshDrivers();
      toast(`Matched ${driver.name} to ${req.to}`);
      bookings = bookings.filter(b=>b.id!==id);refreshRequests();
    }

    // simple toast
    function toast(txt){
      const el=document.createElement('div');el.textContent=txt;el.style.position='fixed';el.style.right='18px';el.style.bottom='18px';el.style.background='#081827';el.style.padding='12px 14px';el.style.borderRadius='10px';el.style.boxShadow='0 8px 22px rgba(2,6,23,0.6)';document.body.appendChild(el);
      setTimeout(()=>el.remove(),2800);
    }

    // simulate notifications
    function simulateNotification(){
      toast('Push sent to nearby drivers');
    }

    // Charts
    const demandCtx = document.getElementById('demandChart');
    const demandChart = new Chart(demandCtx, {
      type:'line',data:{labels:[],datasets:[{label:'Predicted demand (requests)',data:[],fill:true,tension:0.3}]},options:{plugins:{legend:{display:false}}}
    });

    const visitsCtx = document.getElementById('visitsChart');
    const visitsChart = new Chart(visitsCtx, {type:'bar',data:{labels:[],datasets:[{label:'Requests',data:[]}]} ,options:{plugins:{legend:{display:false}}}});

    function runPrediction(){
      // mock prediction: generate next 12 time slots demand
      const labels=[];const data=[];
      const now = new Date();
      for(let i=0;i<12;i++){
        labels.push((now.getHours()+i)%24 + ':00');
        data.push(Math.max(1, Math.round(Math.random()*8 + bookings.length*0.4)));
      }
      demandChart.data.labels=labels;demandChart.data.datasets[0].data=data;demandChart.update();

      // hotspots
      const places=['Tirupati','Bus Stand','Railway Stn','Mall','Movie Hall'];
      hotspotsEl.innerHTML='';
      const picks = places.map(p=>({p,score:Math.round(Math.random()*100)})).sort((a,b)=>b.score-a.score).slice(0,3);
      picks.forEach(pk=>{const li=document.createElement('li');li.textContent=`${pk.p} — score ${pk.score}`;hotspotsEl.appendChild(li)});

      // visits (analytics)
      const topLabels = places;
      const topData = places.map(()=>Math.round(Math.random()*60+20));
      visitsChart.data.labels=topLabels;visitsChart.data.datasets[0].data=topData;visitsChart.update();

      // top places list
      topPlacesEl.innerHTML='';
      places.map((p,i)=>{const div=document.createElement('div');div.className='row';div.innerHTML=`<div>${p}</div><div class=muted>${topData[i]} requests</div>`;topPlacesEl.appendChild(div)});

      // timestamp
      lastUpdateEl.textContent = new Date().toLocaleString();
    }

    // small simulation: new random requests arrive
    setInterval(()=>{
      if(Math.random()<0.4){
        bookings.push({id:'r'+Date.now(),to:['Tirupati','Mall','Bus Stand','Railway Stn'][Math.floor(Math.random()*4)],type:['share','private'][Math.floor(Math.random()*2)],seats:1,created:Date.now()});
        refreshRequests();
        runPrediction();
      }
      // occasionally change driver availability
      if(Math.random()<0.3){
        drivers.forEach(d=>{if(Math.random()<0.25) d.status = (d.status==='available'?'on trip':'available')});
        refreshDrivers();
      }
    },5000);

    // init
    seedDrivers();runPrediction();

    // small helpers for UI buttons
    function matchRide(id){
      window.matchRide && window.matchRide(id);
    }
    // expose small functions to inline onclick
    window.matchRide = function(id){ matchRide(id); };
    window.createBooking = createBooking;
    window.estimateFare = estimateFare;
    window.calcFareFromUI = calcFareFromUI;
    window.simulateNotification = simulateNotification;
  </script>
</body>
</html>
